import"./style-B3HtxGOr.js";document.addEventListener("DOMContentLoaded",async()=>{await S();const h=document.getElementById("register-form"),p=document.getElementById("log-list"),u=document.getElementById("modal-root");g(),h.addEventListener("submit",async a=>{a.preventDefault();const s=new FormData(h),e=s.get("location");let n="UNK";try{const c=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&addressdetails=1`,l=await(await fetch(c)).json();if(l.length>0&&l[0].address&&l[0].address.country_code){const r=l[0].address.country_code.toUpperCase();n=M(r)||r}}catch(c){console.error("国コードの取得に失敗しました",c);return}const o={id:Date.now(),date:s.get("date"),title:s.get("title"),location:e,memo:s.get("memo"),country:n},t=JSON.parse(localStorage.getItem("travelLogs")||"[]");t.push(o),localStorage.setItem("travelLogs",JSON.stringify(t)),h.reset(),g()});function g(){const a=JSON.parse(localStorage.getItem("travelLogs")||"[]");a.sort((e,n)=>new Date(n.date)-new Date(e.date)),p.innerHTML="",p.className="flex flex-col gap-2";const s=document.createElement("div");s.className="h-6",p.appendChild(s),a.forEach(e=>{const n=document.createElement("div");n.className=`
        bg-white/10 backdrop-blur rounded-xl p-4 flex flex-col gap-2
        shadow border border-white/20 text-white/80
      `;const o=document.createElement("div");o.className="flex justify-between items-center";const t=document.createElement("h3");t.className="text-white font-semibold text-base",t.textContent=e.title;const c=document.createElement("span");c.className="text-sm text-white/60",c.textContent=e.date,o.appendChild(t),o.appendChild(c);const d=document.createElement("div");d.className="text-sm text-white/70",d.innerHTML=`<strong>場所：</strong> ${e.location}`;const l=document.createElement("div");l.className="text-sm text-white/60",l.textContent=e.memo?e.memo:"No data";const r=document.createElement("div");r.className="flex gap-2 mt-2";const i=document.createElement("button");i.textContent="編集",i.className="bg-blue-600 hover:bg-blue-500 text-white rounded px-3 py-1 text-sm transition",i.addEventListener("click",()=>y(e));const m=document.createElement("button");m.textContent="削除",m.className="bg-red-600 hover:bg-red-500 text-white rounded px-3 py-1 text-sm transition",m.addEventListener("click",()=>f(e.id,e.location)),r.appendChild(i),r.appendChild(m),n.appendChild(o),n.appendChild(d),n.appendChild(l),n.appendChild(r),p.appendChild(n)})}function f(a,s,e=!1){if(!e&&!confirm("本当にこの記録を削除しますか？"))return;const n=JSON.parse(localStorage.getItem("locationCache")||"{}");delete n[s],localStorage.setItem("locationCache",JSON.stringify(n));const o=E().filter(t=>t.id!==a);w(o),g()}function y(a){u.innerHTML="";const s=document.createElement("div");s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-50",s.addEventListener("click",v=>{v.target===s&&b()});const e=document.createElement("div");e.className="bg-[#1f1f1f] rounded-xl p-6 max-w-sm w-full shadow-lg relative";const n=document.createElement("h2");n.className="text-lg font-bold mb-4 text-white/90",n.textContent="記録を編集";const o=document.createElement("form");o.className="flex flex-col gap-3";const t=document.createElement("input");t.type="date",t.name="date",t.value=a.date,t.required=!0,t.className="bg-white/10 backdrop-blur rounded-lg px-4 py-2 text-white/80 focus:ring focus:ring-blue-600 transition";const c=document.createElement("input");c.type="text",c.name="title",c.value=a.title,c.required=!0,c.className=t.className;const d=document.createElement("input");d.type="text",d.name="location",d.value=a.location,d.required=!0,d.className=t.className;const l=document.createElement("textarea");l.name="memo",l.rows=3,l.textContent=a.memo||"",l.className=t.className;const r=document.createElement("div");r.className="flex justify-end gap-2 mt-3";const i=document.createElement("button");i.textContent="削除",i.className="bg-red-600 hover:bg-red-500 text-white rounded px-4 py-2 text-sm transition",i.addEventListener("click",()=>{confirm("本当に削除しますか？")&&(f(a.id,a.location,!0),b())});const m=document.createElement("button");m.type="submit",m.textContent="保存",m.className="bg-blue-600 hover:bg-blue-500 text-white rounded px-4 py-2 text-sm transition",r.appendChild(m),r.appendChild(i),o.appendChild(t),o.appendChild(c),o.appendChild(d),o.appendChild(l),o.appendChild(r),o.addEventListener("submit",v=>{v.preventDefault();const L={...a,date:t.value,title:c.value,location:d.value,memo:l.value},I=E().map(N=>N.id===a.id?L:N);w(I),b(),g()});const x=document.createElement("button");x.id="close-modal",x.className="absolute top-2 right-2 text-white/50 hover:text-white text-xl",x.innerHTML="&times;",x.addEventListener("click",b),e.appendChild(n),e.appendChild(o),e.appendChild(x),s.appendChild(e),u.appendChild(s)}function b(){u.innerHTML=""}function E(){return JSON.parse(localStorage.getItem("travelLogs")||"[]")}function w(a){localStorage.setItem("travelLogs",JSON.stringify(a))}});let C={};function S(){const p=`${"/travel-log-app".endsWith("/")?"/travel-log-app":"/travel-log-app/"}codes.json`;return console.log(`Loading country code map from: ${p}`),fetch(p).then(u=>u.json()).then(u=>{C={},u.forEach(([g,f])=>{C[g]=f})})}function M(h){return C[h.toUpperCase()]||null}
