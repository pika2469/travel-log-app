import"./style-DoQeHc0Q.js";document.addEventListener("DOMContentLoaded",async()=>{await m();const n=document.getElementById("travel-form"),r=document.getElementById("log-list");o(),n.addEventListener("submit",async a=>{a.preventDefault();const t=new FormData(n),e=t.get("location");let s="UNK";try{const c=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&addressdetails=1`,d=await(await fetch(c)).json();if(d.length>0&&d[0].address&&d[0].address.country_code){const g=d[0].address.country_code.toUpperCase();s=u(g)||g}}catch(c){console.error("国コードの取得に失敗しました",c);return}const i={id:Date.now(),date:t.get("date"),title:t.get("title"),location:e,memo:t.get("memo"),country:s},l=JSON.parse(localStorage.getItem("travelLogs")||"[]");l.push(i),localStorage.setItem("travelLogs",JSON.stringify(l)),n.reset(),o()});function o(){const a=JSON.parse(localStorage.getItem("travelLogs")||"[]");a.sort((t,e)=>new Date(e.date)-new Date(t.date)),r.innerHTML="",a.forEach(t=>{const e=document.createElement("div");e.className="log-card",e.innerHTML=`
        <h3>${t.title} (${t.date})</h3>
        <p><strong>場所:</strong> ${t.location}</p>
        <p>${t.memo}</p>
        <p><strong>国:</strong>${t.country}</p>
        <button class="delete-btn" data-id="${t.id}">削除</button>
      `,e.querySelector(".delete-btn").addEventListener("click",()=>{const s=JSON.parse(localStorage.getItem("locationCache")||"{}");delete s[t.location],localStorage.setItem("locationCache",JSON.stringify(s));const i=t.id,l=a.filter(c=>c.id!==i);localStorage.setItem("travelLogs",JSON.stringify(l)),o()}),r.appendChild(e)})}});let p={};function m(){const r=`${"/travel-log-app".endsWith("/")?"/travel-log-app":"/travel-log-app/"}codes.json`;return console.log(`Loading country code map from: ${r}`),fetch(r).then(o=>o.json()).then(o=>{p={},o.forEach(([a,t])=>{p[a]=t})})}function u(n){return p[n.toUpperCase()]||null}
