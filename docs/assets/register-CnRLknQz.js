import"./style-BUm7X4p0.js";document.addEventListener("DOMContentLoaded",async()=>{await p();const e=document.getElementById("travel-form"),c=document.getElementById("log-list");n(),e.addEventListener("submit",async a=>{a.preventDefault();const t=new FormData(e),o=t.get("location");let r="UNK";try{const s=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(o)}&addressdetails=1`,l=await(await fetch(s)).json();if(l.length>0&&l[0].address&&l[0].address.country_code){const g=l[0].address.country_code.toUpperCase();r=u(g)||g}}catch(s){console.error("国コードの取得に失敗しました",s);return}const i={id:Date.now(),date:t.get("date"),title:t.get("title"),location:o,memo:t.get("memo"),country:r},d=JSON.parse(localStorage.getItem("travelLogs")||"[]");d.push(i),localStorage.setItem("travelLogs",JSON.stringify(d)),e.reset(),n()});function n(){const a=JSON.parse(localStorage.getItem("travelLogs")||"[]");a.sort((t,o)=>new Date(o.date)-new Date(t.date)),c.innerHTML="",a.forEach(t=>{const o=document.createElement("div");o.className="log-card",o.innerHTML=`
        <h3>${t.title} (${t.date})</h3>
        <p><strong>場所:</strong> ${t.location}</p>
        <p>${t.memo}</p>
        <p><strong>国:</strong>${t.country}</p>
        <button class="delete-btn" data-id="${t.id}">削除</button>
      `,o.querySelector(".delete-btn").addEventListener("click",()=>{const r=JSON.parse(localStorage.getItem("locationCache")||"{}");delete r[t.location],localStorage.setItem("locationCache",JSON.stringify(r));const i=t.id,d=a.filter(s=>s.id!==i);localStorage.setItem("travelLogs",JSON.stringify(d)),n()}),c.appendChild(o)})}});let m={};function p(){return fetch("./codes.json").then(e=>e.json()).then(e=>{m={},e.forEach(([c,n])=>{m[c]=n})})}function u(e){return m[e.toUpperCase()]||null}
