import"./style-BUm7X4p0.js";document.addEventListener("DOMContentLoaded",async()=>{await p();const n=document.getElementById("travel-form"),a=document.getElementById("log-list");s(),n.addEventListener("submit",async o=>{o.preventDefault();const t=new FormData(n),e=t.get("location");let r="UNK";try{const c=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&addressdetails=1`,d=await(await fetch(c)).json();if(d.length>0&&d[0].address&&d[0].address.country_code){const g=d[0].address.country_code.toUpperCase();r=u(g)||g}}catch(c){console.error("国コードの取得に失敗しました",c);return}const i={id:Date.now(),date:t.get("date"),title:t.get("title"),location:e,memo:t.get("memo"),country:r},l=JSON.parse(localStorage.getItem("travelLogs")||"[]");l.push(i),localStorage.setItem("travelLogs",JSON.stringify(l)),n.reset(),s()});function s(){const o=JSON.parse(localStorage.getItem("travelLogs")||"[]");o.sort((t,e)=>new Date(e.date)-new Date(t.date)),a.innerHTML="",o.forEach(t=>{const e=document.createElement("div");e.className="log-card",e.innerHTML=`
        <h3>${t.title} (${t.date})</h3>
        <p><strong>場所:</strong> ${t.location}</p>
        <p>${t.memo}</p>
        <p><strong>国:</strong>${t.country}</p>
        <button class="delete-btn" data-id="${t.id}">削除</button>
      `,e.querySelector(".delete-btn").addEventListener("click",()=>{const r=JSON.parse(localStorage.getItem("locationCache")||"{}");delete r[t.location],localStorage.setItem("locationCache",JSON.stringify(r));const i=t.id,l=o.filter(c=>c.id!==i);localStorage.setItem("travelLogs",JSON.stringify(l)),s()}),a.appendChild(e)})}});let m={};function p(){return fetch("/travel-log-appcodes.json").then(a=>a.json()).then(a=>{m={},a.forEach(([s,o])=>{m[s]=o})})}function u(n){return m[n.toUpperCase()]||null}
